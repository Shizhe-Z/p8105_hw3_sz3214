---
title: "p8105_hw3_sz3214"
author: "Shizhe Zhang"
date: "2024-10-08"
output: html_document

---

```{r setup, include=FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(patchwork)
```

# Problem 1

**load data**
```{r}
library(p8105.datasets)
data("ny_noaa")
```

**Overall**
```{r}
str(ny_noaa)
colMeans(is.na(ny_noaa)) * 100
```

The dataset consists of 2,595,176 rows and 7 columns. Each row represents a daily weather observation, and the key variables include:

`id`: A character variable identifying the weather station.
`date`: A date variable representing the date of the observation.
`prcp`: An integer variable indicating precipitation.
`snow`: An integer variable for snowfall measurements.
`snwd`: An integer variable for snow depth.
`tmax`: A character variable representing the maximum temperature for the day.
`tmin`: A character variable representing the minimum temperature.

Several key variables contain many NA values: 

`prcp`: 5.62% missing value.
`snow`: 14.69% missing value.
`snwd`: 22.80% missing value.
`tmax`: 43.71% missing value.
`tmin`: 43.71% missing value.

**data cleaning**
```{r}
ny_noaa = ny_noaa |> 
  janitor::clean_names() |> 
  mutate(year = as.numeric(format(date, "%Y")),
         month = as.numeric(format(date, "%m")),
         day = as.numeric(format(date, "%d")),
         tmax = as.integer(tmax) / 10,
         tmin = as.integer(tmin) / 10,
         prcp = prcp / 10)

ny_noaa |> 
  group_by(snow) |> 
  summarise(count = n()) |> 
  arrange(desc(count)) |> 
  head(n=5)
```
The most commonly observed value for snowfall is 0. 

**plot 1**
```{r}
ny_noaa |> 
  filter(month == '1' | month == '7') |> 
  group_by(year, month) |> 
  summarise(avg_tmax = mean(tmax, na.rm = TRUE), .groups = "drop") |> 
  ungroup() |> 
  ggplot(aes(x = year, y = avg_tmax)) +
  geom_point() +
  facet_wrap(~month) +
  labs(
    title = "Average Max Temperature in January and July Across Years",
    x = "Year", y = "Average Max Temperature (°C)"
  ) 
```
There is a gradual increase around 0°C in temperatures  over time in Jan. In July, the temperatures are around 25-30°C across all years and didn't show obviously trend.
In the January, there are a few data points slightly above or below 0°C, which could be outliers.

**plot 2**
```{r}
tmax_tmin = ny_noaa |> 
  filter(!is.na(tmax) & !is.na(tmin)) |> 
  ggplot(aes(x=tmin, y=tmax)) +
  geom_hex(bins = 30) +
  labs(title = "Hexbin Plot of Tmax vs Tmin", x = "Tmin (°C)", y = "Tmax (°C)")

snow_dist = ny_noaa |> 
  filter(snow > 0 & snow < 100) |> 
  ggplot(aes(x=year, y=snow)) +
  geom_violin() +
  labs(title = "Snowfall Distribution (0 < Snowfall < 100) by Year", x = "Snowfall (mm)", y = "Year")

tmax_tmin + snow_dist
```

# Problem 2

**data cleaning**
```{r}
accel = read.csv("nhanes_accel.csv") |> 
  janitor::clean_names()


covar = read.csv("nhanes_covar.csv", skip = 4) |> 
  janitor::clean_names() |> 
  filter(age >= 21, !is.na(sex), !is.na(age), !is.na(bmi), !is.na(education)) |> 
  mutate(
    sex = factor(sex, levels = c(1, 2), labels = c("Male", "Female")),
    education = factor(education, 
                          levels = c(1, 2, 3), 
                          labels = c("Less than high school", 
                                     "High school equivalent", 
                                     "More than high school"))
)
```



